\begin{tikzpicture}
\pgfdeclarelayer{background}
\pgfsetlayers{background,main}

\def\rounding {0}

\tikzset{mstyle/.style={
  matrix of nodes,
  inner sep=2,
  outer sep=0,
  text height=\ht\strutbox,
  text depth=\dp\strutbox
}}

\matrix (M1) at (1, 0) [style=mstyle] {
  Transfer\\
};

\matrix (M2) at (0, -2) [style=mstyle] {
  Transaction & [10] Transaction & [10] Transaction \\
};

\matrix (M3) at (1, -4) [style=mstyle] {
  Token packet & [10] Data packet & [10] Handshake packet \\
};

\matrix (M4) at (0, -6) [style=mstyle] {
  PID & Address & Endpoint & CRC & [10] PID & Data & CRC & [10] PID \\
};

\draw[thick]
  (M1-1-1.south) -- (M2-1-1.north)
  (M1-1-1.south) -- (M2-1-2.north)
  (M1-1-1.south) -- (M2-1-3.north)
  (M2-1-1.south) -- (M3-1-1.north)
  (M2-1-1.south) -- (M3-1-2.north)
  (M2-1-1.south) -- (M3-1-3.north)
  (M3-1-1.south) -- (M4-1-1.north)
  (M3-1-1.south) -- (M4-1-2.north)
  (M3-1-1.south) -- (M4-1-3.north)
  (M3-1-1.south) -- (M4-1-4.north)
  (M3-1-2.south) -- (M4-1-5.north)
  (M3-1-2.south) -- (M4-1-6.north)
  (M3-1-2.south) -- (M4-1-7.north)
  (M3-1-3.south) -- (M4-1-8.north);

\begin{pgfonlayer}{background}
  \def \framepath {
    (M1-1-1.north west) -- (M1-1-1.north east) -- (M1-1-1.south east) -- (M1-1-1.south west) -- cycle
    (M2-1-1.north west) -- (M2-1-1.north east) -- (M2-1-1.south east) -- (M2-1-1.south west) -- cycle
    (M2-1-2.north west) -- (M2-1-2.north east) -- (M2-1-2.south east) -- (M2-1-2.south west) -- cycle
    (M2-1-3.north west) -- (M2-1-3.north east) -- (M2-1-3.south east) -- (M2-1-3.south west) -- cycle
    (M3-1-1.north west) -- (M3-1-1.north east) -- (M3-1-1.south east) -- (M3-1-1.south west) -- cycle
    (M3-1-2.north west) -- (M3-1-2.north east) -- (M3-1-2.south east) -- (M3-1-2.south west) -- cycle
    (M3-1-3.north west) -- (M3-1-3.north east) -- (M3-1-3.south east) -- (M3-1-3.south west) -- cycle
    (M4-1-1.north west) -- (M4-1-4.north east) -- (M4-1-4.south east) -- (M4-1-1.south west) -- cycle
    (M4-1-5.north west) -- (M4-1-7.north east) -- (M4-1-7.south east) -- (M4-1-5.south west) -- cycle
    (M4-1-8.north west) -- (M4-1-8.north east) -- (M4-1-8.south east) -- (M4-1-8.south west) -- cycle
  }

  %~ \begin{scope}
    %~ \clip[rounded corners = \rounding] \framepath;
    %~ \fill[gray!20] (M1-1-1.north west) rectangle (M1-1-1.south east);
    %~ \fill[purple!20] (M2-1-1.north west) rectangle (M2-1-1.south east);
    %~ \fill[purple!20] (M2-1-2.north west) rectangle (M2-1-2.south east);
    %~ \fill[purple!20] (M2-1-3.north west) rectangle (M2-1-3.south east);
    %~ \fill[lime!20] (M3-1-1.north west) rectangle (M3-1-1.south east);
    %~ \fill[orange!20] (M3-1-2.north west) rectangle (M3-1-2.south east);
    %~ \fill[olive!20] (M3-1-3.north west) rectangle (M3-1-3.south east);
    %~ \fill[yellow!20] (M4-1-1.north west) rectangle (M4-1-1.south east);
    %~ \fill[red!20] (M4-1-2.north west) rectangle (M4-1-2.south east);
    %~ \fill[green!20] (M4-1-3.north west) rectangle (M4-1-3.south east);
    %~ \fill[blue!20] (M4-1-4.north west) rectangle (M4-1-4.south east);
    %~ \fill[yellow!20] (M4-1-5.north west) rectangle (M4-1-5.south east);
    %~ \fill[teal!20] (M4-1-6.north west) rectangle (M4-1-6.south east);
    %~ \fill[blue!20] (M4-1-7.north west) rectangle (M4-1-7.south east);
    %~ \fill[yellow!20] (M4-1-8.north west) rectangle (M4-1-8.south east);
  %~ \end{scope}
  
  \draw (M4-1-1.north east) -- (M4-1-1.south east)
        (M4-1-2.north east) -- (M4-1-2.south east)
        (M4-1-3.north east) -- (M4-1-3.south east)
        (M4-1-5.north east) -- (M4-1-5.south east)
        (M4-1-6.north east) -- (M4-1-6.south east);

  \draw[thick, rounded corners = \rounding] \framepath;
\end{pgfonlayer}

\end{tikzpicture}
